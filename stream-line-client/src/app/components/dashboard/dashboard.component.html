<div class="container-fluid">
  <div class="row">
    <!-- Sidebar -->
    <div class="col-md-3 sidebar border-end">
      <h5 class="p-3">Channels</h5>
      <ul class="list-group list-group-flush" style="max-height: 40vh; overflow-y: auto;">
        <li
          class="list-group-item channel-item"
          *ngFor="let channel of channels"
          (click)="selectChannel(channel)">
          {{ channel.name }}
        </li>
      </ul>

      <h5 class="p-3">Friends</h5>
      <ul class="list-group list-group-flush" style="max-height: 40vh; overflow-y: auto;">
        <li
          class="list-group-item channel-item"
          *ngFor="let friend of friends"
          (click)="selectFriend(friend)">
          {{ friend.username }}
        </li>
      </ul>

      <!-- Create Channel Button -->
      <div class="p-3">
        <button class="btn btn-success w-100 mb-2" (click)="openCreateChannelModal()">
          Create Channel
        </button>
        <button class="btn btn-primary w-100" (click)="openAddFriendModal()">
          Add Friend
        </button>
      </div>
    </div>

    <!-- Chat Area -->
    <div class="col-md-9 chat">
      <div class="p-3">
        <h4 class="border-bottom pb-2">{{ selectedChatName }}</h4>
        <div class="chat-messages" style="height: 80vh; overflow-y: auto; background-color: #f1f1f1; padding: 10px;">
          <div *ngFor="let message of messages" class="mb-3">
            <strong>{{ message.authorUsername == currentLoggedUsername ? 'You' : message.authorUsername }}:</strong> {{ message.content }}
            <span class="text-muted" style="font-size: 0.9em;">{{ message.timestamp | date:'medium' }}</span>
          </div>
        </div>

        <!-- Chat Input -->
        <div class="mt-3">
          <form class="d-flex" (ngSubmit)="sendMessage()">
            <input
              type="text"
              class="form-control me-2"
              placeholder="Type a message..."
              [(ngModel)]="newMessage"
              name="messageInput">
            <button type="submit" class="btn btn-primary">Send</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal for Adding a Friend -->
  <div
    class="modal fade"
    id="addFriendModal"
    tabindex="-1"
    aria-labelledby="addFriendModalLabel"
    aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="addFriendModalLabel">Add a Friend</h5>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
            aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form (ngSubmit)="addFriend()">
            <div class="mb-3">
              <label for="friendSearchInput" class="form-label">Search for Friends</label>
              <input
                type="text"
                class="form-control"
                id="friendSearchInput"
                [(ngModel)]="searchFriendQuery"
                (input)="searchFriends()"
                name="friendSearch"
                placeholder="Enter username"
                autocomplete="off">
            </div>
            <div class="dropdown" *ngIf="searchResults.length > 0">
              <ul class="dropdown-menu show">
                <li
                  *ngFor="let result of searchResults"
                  class="dropdown-item"
                  (click)="selectFriendFromSearch(result)">
                  {{ result.username }}
                </li>
              </ul>
            </div>
            <button type="submit" class="btn btn-primary mt-2" [disabled]="!selectedFriend">
              Add Friend
            </button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal for Creating a Channel -->
  <div
    class="modal fade"
    id="createChannelModal"
    tabindex="-1"
    aria-labelledby="createChannelModalLabel"
    aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="createChannelModalLabel">Create a New Channel</h5>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
            aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form (ngSubmit)="createChannel()">
            <div class="mb-3">
              <label for="channelNameInput" class="form-label">Channel Name</label>
              <input
                type="text"
                class="form-control"
                id="channelNameInput"
                [(ngModel)]="newChannelName"
                name="channelName"
                placeholder="Enter channel name"
                required>
            </div>
            <button type="submit" class="btn btn-primary">Create</button>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
